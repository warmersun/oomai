%import common.WS
%ignore WS

// Keywords (case-sensitive, assume uppercase for generation)
MATCH: "MATCH"
OPTIONAL: "OPTIONAL"
UNWIND: "UNWIND"
AS: "AS"
WITH: "WITH"
RETURN: "RETURN"
UNION: "UNION"
ALL: "ALL"
DISTINCT: "DISTINCT"
WHERE: "WHERE"
ORDER: "ORDER"
BY: "BY"
ASC: "ASC"
DESC: "DESC"
SKIP: "SKIP"
LIMIT: "LIMIT"
SHORTESTPATH: "SHORTESTPATH"
ALLSHORTESTPATHS: "ALLSHORTESTPATHS"
IS: "IS"
OR: "OR"
AND: "AND"
NOT: "NOT"
STARTS: "STARTS"
WITH_KW: "WITH"  // Disambiguate
ENDS: "ENDS"
CONTAINS: "CONTAINS"
IN: "IN"
NULL: "NULL"
TRUE: "TRUE"
FALSE: "FALSE"
COUNT: "COUNT"
CASE: "CASE"
WHEN: "WHEN"
THEN: "THEN"
ELSE: "ELSE"
END: "END"
EXISTS: "EXISTS"
REDUCE: "REDUCE"
ANY: "ANY"
SINGLE: "SINGLE"
NONE: "NONE"

// Simplified built-in functions (group essentials, remove APOC)
BUILTIN_FUNCTION: "ABS" | "COALESCE" | "TOSTRING" | "TOINTEGER" | "TOFLOAT" | "LENGTH" | "SIZE" | "ID" | "LABELS" | "TYPE"
                | "STARTNODE" | "ENDNODE" | "HEAD" | "LAST" | "TAIL" | "RANGE" | "SUBSTRING" | "REPLACE"
                | "TOLOWER" | "TOUPPER" | "LEFT" | "RIGHT" | "SPLIT" | "REVERSE"
                | "DATE" | "DATETIME" | "LOCALDATETIME" | "TIME" | "LOCALTIME" | "DURATION"
                | "TRIM" | "KEYS" | "PROPERTIES" | "ELEMENTID" | "NODES" | "RELATIONSHIPS" | "COLLECT"

// Literals & identifiers
STRING_LITERAL: /'([^'\\]*(\\.[^'\\]*)*)'/ | /"([^"\\]*(\\.[^"\\]*)*)"/
DELIMITED_IDENTIFIER: /`([^`]*(``[^`]*)*)`/
IDENTIFIER: /[a-zA-Z_]\w*/
LOWER_IDENTIFIER: /[a-z_][a-z0-9_]*/
UNSIGNED_DECIMAL_INTEGER: /\d+/
SIGNED_NUMERIC_LITERAL: /-?\d+(\.\d+)?/ | /-(inf|infinity)/ | /nan/

// Start (unchanged)
?start: program
program: statement
statement: composite_statement

// Simplified statements (merged some)
composite_statement: linear_statement (UNION set_quantifier? linear_statement)*
linear_statement: primitive_statement+ primitive_result_statement?
primitive_statement: primitive_query_statement
primitive_query_statement: match_statement | unwind_statement | with_statement
match_statement: optional_match_statement | simple_match_statement
optional_match_statement: OPTIONAL simple_match_statement
simple_match_statement: MATCH graph_pattern_binding_table
unwind_statement: UNWIND value_expression AS binding_variable
with_statement: WITH return_statement_body where_clause? order_by_and_page_clause?
primitive_result_statement: return_statement
return_statement: RETURN return_statement_body order_by_and_page_clause?
return_statement_body: set_quantifier? return_item_list
return_item_list: ("*" | return_item) ("," return_item)*
return_item: value_expression return_item_alias?
return_item_alias: AS identifier
order_by_and_page_clause: order_by_clause offset_clause? limit_clause? | offset_clause limit_clause? | limit_clause
order_by_clause: ORDER BY sort_specification_list
sort_specification_list: sort_specification ("," sort_specification)*
sort_specification: sort_key ordering_specification?
sort_key: value_expression
ordering_specification: ASC | DESC
offset_clause: SKIP value_expression
limit_clause: LIMIT value_expression
graph_pattern_binding_table: graph_pattern
where_clause: WHERE search_condition
set_quantifier: ALL | DISTINCT

// Patterns (simplified alternatives)
graph_pattern: path_pattern_list graph_pattern_where_clause?
path_pattern_list: path_pattern ("," path_pattern)*
graph_pattern_where_clause: where_clause
path_pattern: path_variable_declaration? path_pattern_expression
path_variable_declaration: binding_variable "="
path_pattern_expression: path_term | legacy_shortest_path_pattern
legacy_shortest_path_pattern: (SHORTESTPATH | ALLSHORTESTPATHS) "(" node_pattern relationship_pattern node_pattern ")"
path_term: path_factor+
path_factor: path_primary | path_primary graph_pattern_quantifier
path_primary: element_pattern | "(" subpath_variable_declaration? path_pattern_expression parenthesized_path_pattern_where_clause? ")"
subpath_variable_declaration: binding_variable "="
parenthesized_path_pattern_where_clause: WHERE value_expression
element_pattern: node_pattern | relationship_pattern
node_pattern: "(" node_pattern_filler? ")"
node_pattern_filler: binding_variable is_node_label_expression? element_pattern_predicate? | is_node_label_expression element_pattern_predicate? | element_pattern_predicate
element_pattern_predicate: element_pattern_where_clause | element_property_specification
element_pattern_where_clause: WHERE value_expression
element_property_specification: "{" property_key_value_pair_list "}"
property_key_value_pair_list: property_key_value_pair ("," property_key_value_pair)*
property_key_value_pair: key_value_pair
key_value_pair: property_name ":" value_expression
relationship_pattern: full_relationship_pointing_left | full_relationship_pointing_right | full_relationship_left_or_right | full_relationship_any_direction
full_relationship_pointing_left: "<" "-" ("[" relationship_pattern_filler? "]")? "-"
full_relationship_pointing_right: "-" ("[" relationship_pattern_filler? "]")? "-" ">"
full_relationship_left_or_right: "<" "-" ("[" relationship_pattern_filler? "]")? "-" ">"
full_relationship_any_direction: "-" ("[" relationship_pattern_filler? "]")? "-"
relationship_pattern_filler: binding_variable is_relationship_label_expression? path_length? element_pattern_predicate? | is_relationship_label_expression path_length? element_pattern_predicate? | path_length element_pattern_predicate? | element_pattern_predicate
path_length: "*" (lower_and_upper_bound_path_length | fixed_path_length)?
lower_and_upper_bound_path_length: lower_bound_path_length? ".." upper_bound_path_length?
fixed_path_length: UNSIGNED_DECIMAL_INTEGER
graph_pattern_quantifier: "*" | "+" | "{" UNSIGNED_DECIMAL_INTEGER "}" | "{" lower_bound_path_length? "," upper_bound_path_length? "}"
lower_bound_path_length: UNSIGNED_DECIMAL_INTEGER
upper_bound_path_length: UNSIGNED_DECIMAL_INTEGER
is_node_label_expression: ":" node_label_expression_legacy | is_label_expression
is_relationship_label_expression: ":" relationship_label_expression_legacy | is_label_expression
is_label_expression: (":" | IS) label_expression
node_label_expression_legacy: label_primary (":" label_primary)*
relationship_label_expression_legacy: label_primary ("|" label_primary)*
label_expression: label_term | label_expression "|" label_term
label_term: label_factor | label_term "&" label_factor
label_factor: label_primary | "!" label_primary
label_primary: label_name | "(" label_expression ")" | "%"

// Names (unchanged)
label_name: identifier
property_name: identifier
binding_variable: LOWER_IDENTIFIER
identifier: IDENTIFIER | DELIMITED_IDENTIFIER

// Expressions (simplified booleans and arithmetics)
value_expression: boolean_value_expression
search_condition: boolean_value_expression
boolean_value_expression: boolean_term | boolean_value_expression OR boolean_term
boolean_term: boolean_factor | boolean_term AND boolean_factor
boolean_factor: NOT* boolean_primary
boolean_primary: pattern_expression | predicate
predicate: comparison_predicate
comparison_predicate: simple_comparison_predicand simple_comparison_predicate_part_2*
simple_comparison_predicand: advanced_comparison_predicand advanced_comparison_predicate_part_2?
simple_comparison_predicate_part_2: simple_comp_op advanced_comparison_predicand
simple_comp_op: "=" | "<>" | "<" | ">" | "<=" | ">="
advanced_comparison_predicand: arithmetic_value_expression
advanced_comparison_predicate_part_2: advanced_comp_op advanced_comparison_predicand | IS NOT? NULL | is_label_expression
advanced_comp_op: CONTAINS | IN | "=~" | STARTS WITH_KW | ENDS WITH_KW
arithmetic_value_expression: arithmetic_term | arithmetic_value_expression "+" arithmetic_term | arithmetic_value_expression "-" arithmetic_term
arithmetic_term: arithmetic_factor | arithmetic_term "*" arithmetic_factor | arithmetic_term "/" arithmetic_factor | arithmetic_term "%" arithmetic_factor
arithmetic_factor: arithmetic_unary | arithmetic_factor "^" arithmetic_unary
arithmetic_unary: ("+" | "-")? postfix_expression
postfix_expression: value_expression_primary | postfix_expression postfix_operator
postfix_operator: "." property_name | "[" value_expression "]" | "[" slicing_from? ".." slicing_to? "]"
slicing_from: value_expression
slicing_to: value_expression
value_expression_primary: "(" value_expression ")" | non_parenthesized_value_expression_primary
non_parenthesized_value_expression_primary: general_parameter_reference | case_expression | count_star | function_invocation | exists_expression | map_projection | list_comprehension | pattern_comprehension | reduce_expression | quantifier_expression | shortest_path_expression | value_specification | binding_variable
case_expression: simple_case | search_case
simple_case: CASE value_expression simple_when_clause+ else_clause? END
search_case: CASE searched_when_clause+ else_clause? END
simple_when_clause: WHEN when_operand_list THEN value_expression
searched_when_clause: WHEN search_condition THEN value_expression
when_operand_list: when_operand ("," when_operand)*
when_operand: value_expression
else_clause: ELSE value_expression
exists_expression: EXISTS "{" graph_pattern "}" | EXISTS "(" value_expression ")"
map_projection: binding_variable "{" map_projection_element_list? "}"
map_projection_element_list: map_projection_element ("," map_projection_element)*
map_projection_element: key_value_pair | "." property_name | binding_variable | ".*"
list_comprehension: "[" list_element_source list_element_filter_and_projection? "]"
list_element_filter_and_projection: list_element_filter list_element_projection? | list_element_filter
list_element_source: binding_variable IN value_expression
list_element_filter: WHERE value_expression
list_element_projection: "|" value_expression
pattern_comprehension: "[" pattern_source pattern_filter_and_projection "]"
pattern_source: (binding_variable "=")? simple_path_pattern
pattern_filter_and_projection: pattern_filter? pattern_projection
pattern_filter: WHERE value_expression
pattern_projection: "|" value_expression
reduce_expression: REDUCE "(" binding_variable "=" value_expression "," binding_variable IN value_expression "|" value_expression ")"
quantifier_expression: quantifier "(" binding_variable IN value_expression WHERE value_expression ")"
quantifier: ALL | ANY | SINGLE | NONE
function_invocation: BUILTIN_FUNCTION "(" set_quantifier? function_argument_list? ")"
function_argument_list: function_argument ("," function_argument)*
function_argument: value_expression
count_star: COUNT "(" "*" ")"
pattern_expression: simple_path_pattern
shortest_path_expression: legacy_shortest_path_pattern
simple_path_pattern: node_pattern (relationship_pattern node_pattern)*
value_specification: literal | "[" list_element_list? "]" | "{" field_list? "}"
list_element_list: value_expression ("," value_expression)*
field_list: field ("," field)*
field: property_name ":" value_expression
literal: SIGNED_NUMERIC_LITERAL | boolean_literal | STRING_LITERAL | NULL
general_parameter_reference: "$" parameter_name
parameter_name: identifier
field_name: identifier
boolean_literal: TRUE | FALSE